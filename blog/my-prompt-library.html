<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Prompt Library | Keith Tyser</title>
  <!-- Tailwind with typography plugin -->
  <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
  <!-- marked.js for markdown parsing -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js" defer></script>
  <!-- Plugin: add GitHub‑style heading IDs -->
  <script src="https://cdn.jsdelivr.net/npm/marked-gfm-heading-id/lib/index.umd.js" defer></script>
  <style>
    /* dark-mode tweaks for prose */
    .dark .prose :where(th, td) { border-color: rgba(255,255,255,0.15); }
    .prose table { width: 100%; }
  </style>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-100 transition-colors duration-300">

  <div class="flex flex-col lg:flex-row max-w-7xl mx-auto">
    <!-- Sidebar Nav -->
    <nav id="toc-sidebar" class="w-full lg:w-64 xl:w-72 px-4 py-10 lg:fixed lg:top-4 lg:h-[calc(100vh-2rem)] lg:overflow-y-auto hidden lg:block border-b lg:border-b-0 lg:border-r border-gray-200 dark:border-gray-700">
      <h2 class="text-lg font-semibold mb-4">On this page</h2>
      <ul id="toc-list" class="space-y-2">
        <!-- ToC items will be generated here -->
         <li><a href="#" class="text-sm text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400">Loading...</a></li>
      </ul>
    </nav>

    <!-- Main Content Area -->
    <main class="flex-1 px-4 py-10 lg:py-0 lg:ml-64 xl:ml-72">
      <header class="mb-10">
        <a href="../index.html" class="text-sm text-blue-600 dark:text-blue-400 hover:underline">&larr; back home</a>
      </header>
      <article id="content" class="prose lg:prose-lg dark:prose-invert mx-auto max-w-3xl"></article>
    </main>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Enable GitHub‑style heading IDs so Table of Contents links work
      if (typeof markedGfmHeadingId !== 'undefined') {
        marked.use(markedGfmHeadingId.gfmHeadingId());
        console.log('marked-gfm-heading-id plugin applied.'); // Log: Plugin applied
      } else {
        console.warn('markedGfmHeadingId plugin not loaded; TOC anchors may not work.');
      }
      console.log('Script start. Marked configured.'); // Log: Script start

      fetch('my-prompt-library.md')
        .then(res => {
          console.log('Fetched markdown, status:', res.status); // Log: Fetch status
          if (!res.ok) {
            throw new Error(`HTTP error! status: ${res.status}`);
          }
          return res.text();
        })
        .then(md => {
          console.log('Markdown content fetched:', md.substring(0, 100) + '...'); // Log: Raw MD (first 100 chars)
          try {
            console.log('Final content passed to marked.parse():', md.substring(0, 100) + '...'); // Log: Content for marked (first 100 chars)
            const contentElement = document.getElementById('content');
            contentElement.innerHTML = marked.parse(md.trim());
            console.log('Content updated in DOM.'); // Log: DOM updated

            // Add copy buttons to code blocks
            contentElement.querySelectorAll('pre').forEach(pre => {
              // Ensure the pre block itself is positioned relatively for the button
              pre.style.position = 'relative';
              pre.style.paddingTop = '2.5rem'; // Add padding to make space for the button

              const button = document.createElement('button');
              button.textContent = 'Copy';
              // Tailwind classes for styling and positioning
              button.className = 'absolute top-2 right-2 px-2 py-1 text-xs font-medium rounded bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors';

              button.addEventListener('click', () => {
                const code = pre.querySelector('code');
                if (code) {
                  navigator.clipboard.writeText(code.textContent || '').then(() => {
                    button.textContent = 'Copied!';
                    setTimeout(() => {
                      button.textContent = 'Copy';
                    }, 1500); // Reset after 1.5 seconds
                  }).catch(err => {
                    console.error('Failed to copy text: ', err);
                    button.textContent = 'Error'; // Indicate copy failure
                     setTimeout(() => {
                      button.textContent = 'Copy';
                    }, 1500);
                  });
                }
              });

              pre.appendChild(button);
            });

            // Generate ToC for sidebar
            const tocList = document.getElementById('toc-list');
            const headings = contentElement.querySelectorAll('h2, h3'); // Select h2 and h3
            tocList.innerHTML = ''; // Clear the loading message

            headings.forEach(heading => {
              if (heading.id) { // Only include headings that have an ID
                const listItem = document.createElement('li');
                const link = document.createElement('a');
                link.href = `#${heading.id}`;
                link.textContent = heading.textContent;
                
                // Base styling
                let linkClasses = 'block text-sm text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors py-1';
                
                // Indent H3s
                if (heading.tagName === 'H3') {
                  linkClasses += ' pl-4';
                }

                link.className = linkClasses;
                listItem.appendChild(link);
                tocList.appendChild(listItem);
              }
            });

          } catch (e) {
            console.error('Error during parsing or DOM update:', e); // Log: Error caught
            // Fallback: Render the whole thing if parsing fails
            console.log('Falling back to rendering raw markdown due to error.'); // Log: Fallback trigger
            document.getElementById('content').innerHTML = marked.parse(md);
          }
        })
        .catch(error => {
           console.error('Error fetching markdown:', error); // Log: Fetch error
           document.getElementById('content').innerHTML = '<p>Error loading blog content.</p>';
        });
    });
  </script>
</body>
</html> 